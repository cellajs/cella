/**
 * Cache token utilities for server-side entity cache.
 *
 * Cache tokens are simple random keys (nanoid) generated by CDC Worker and shared
 * via SSE notifications. All users receive the same token for the same entity version,
 * enabling shared caching. First user to fetch enriches the cache; subsequent users
 * get a cache hit.
 *
 * Authorization is handled upstream at SSE subscription time - tokens don't encode
 * authorization. TTL is managed by the cache itself.
 */

import { nanoid } from 'nanoid';

/** Token TTL: 10 minutes (matches entity cache TTL) - exported for external use */
export const cacheTokenTtl = 10 * 60 * 1000;

/**
 * Generate a cache token (simple random key).
 * Called by CDC Worker when processing entity changes.
 *
 * @returns A 21-character nanoid token
 */
export function generateCacheToken(): string {
  return nanoid();
}
