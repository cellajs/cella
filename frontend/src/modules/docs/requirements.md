# Docs Module Requirements

## Progress Tracker

### âœ… Completed
1. **OpenAPI Parser Plugin** (`vite/openapi-parser.ts`)
   - Custom `@hey-api/openapi-ts` plugin that transforms OpenAPI spec into lightweight operation summaries
   - Generates two split files: `operations.gen.ts` and `tags.gen.ts` in `api.gen/docs/`
   - Barrel file (`index.ts`) for clean imports
   - Extracts: id, method, path, tags, summary, deprecated, hasAuth, hasParams, hasRequestBody
   - Tag metadata with operation counts

2. **Plugin Integration** (`openapi-ts.config.ts`)
   - Added `openapiParserPlugin()` to plugins array
   - Configured to run after `@hey-api/typescript` dependency
   - Generates to `src/api.gen/docs/` directory

3. **Generated Files** (`src/api.gen/docs/`)
   - `operations.gen.ts` - OperationSummary interface + operations array (809 lines)
   - `tags.gen.ts` - TagSummary interface + tags array (55 lines)
   - `index.ts` - Barrel export file

4. **Routing** (`routes/`)
   - `docs-routes.tsx` - Route definition with lazy-loaded component
   - Added DocsRoute to route tree
   - Uses PublicLayoutRoute parent (accessible without auth)

5. **Basic Page Component** (`modules/docs/docs-page.tsx`)
   - Sidebar with tag navigation (All Operations + individual tags)
   - Search functionality (filters by path, summary, id)
   - Operations list with:
     - Color-coded HTTP method badges
     - Path and summary display
     - Tag links
     - Indicators for auth, params, request body
     - Deprecated flag
   - Responsive layout using MarketingNav and MarketingFooter

### ğŸš§ In Progress
- None currently

### ğŸ“‹ To Do
1. **Components** (Advanced)
   - [ ] `docs-layout.tsx` - Improved layout with better sidebar
   - [ ] `operation-table.tsx` - DataTable integration with expandable rows
   - [ ] `operation-columns.tsx` - Column definitions
   - [ ] `operation-row-details.tsx` - Expandable row with lazy-loaded full details
   - [ ] `schema-viewer.tsx` - Schema/model viewer
   - [ ] `parameter-table.tsx` - Parameters display

2. **Hooks**
   - [ ] `use-openapi-spec.ts` - Hook to access full spec for details

3. **Features** (Enhancements)
   - [x] Basic tag filtering (sidebar)
   - [x] Basic search operations
   - [ ] Virtual scrolling for 100+ operations (DataTable integration)
   - [ ] Code split schema viewer
   - [ ] Mobile responsive improvements
   - [ ] Expandable row details with full OpenAPI spec data
   - [ ] Parameters, request/response schemas display
   - [ ] URL hash navigation

---

## Overview

A fast, static API documentation viewer for OpenAPI 3.1 specifications. Built as a lightweight alternative to Scalar, focusing on performance and simplicity without interactive features.

**V1 Scope**: Table view only with expandable rows for operation details.

## Module Structure

```
frontend/src/modules/docs/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ docs-layout.tsx          # Main layout (sidebar + content)
â”‚   â”œâ”€â”€ docs-sidebar.tsx          # Navigation sidebar
â”‚   â”œâ”€â”€ operation-table.tsx       # Table view using DataTable
â”‚   â”œâ”€â”€ operation-columns.tsx     # Column definitions (see use-columns pattern)
â”‚   â”œâ”€â”€ operation-row-details.tsx # Expandable row details (lazy loads from spec)
â”‚   â”œâ”€â”€ schema-viewer.tsx         # Schema/model viewer
â”‚   â””â”€â”€ parameter-table.tsx       # Parameters display
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ use-openapi-spec.ts      # Hook to access full spec for details
â”œâ”€â”€ docs-page.tsx                 # Main route component
â””â”€â”€ requirements.md               # This file

vite/
â””â”€â”€ docs-plugin/                  # openapi-ts plugin
    â”œâ”€â”€ index.ts                  # Plugin export
    â””â”€â”€ transform.ts              # Transform spec to lightweight operations array
```

**Note**: Parser is now an openapi-ts plugin that generates a lightweight operations array.

## Implementation References
 & Parser

### openapi-ts Plugin Architecture
Create a custom openapi-ts plugin that generates a lightweight operations array:

**Plugin Configuration** (`openapi-ts.config.ts`):
```typescript
import { docsPlugin } from './vite/docs-plugin';

export const openApiConfig: UserConfig = {
  output: {
    path: './src/api.gen',
    source: { fileName: 'openapi', path: './' },
  },
  plugins: [
    // ... existing plugins
    docsPlugin({ fileName: 'docs-operations' }),
  ],
};
```

**Plugin Output** (`src/api.gen/docs-operations.gen.ts`):
```typescript
// Generated by docs-plugin
export const operations: OperationSummary[] = [
  {
    id: 'getUser',
    method: 'get',
    path: '/users/{id}',
    tags: ['users'],
    summary: 'Get user by ID',
    deprecated: false,
    hasAuth: true,
    hasParams: true,
    hasRequestBody: false,
  },
  // ... more operations
];

export const tags: TagSummary[] = [
  { name: 'users', description: 'User operations', count: 12 },
  // ... more tags
];
```

### Primary Data (Plugin Output)
Lightweight array with only what's needed for table + sidebar:

```typescript
interface OperationSummary {
  id: string              // operationId or generated
  method: string          // get, post, put, delete, etc.
  path: string            // /api/users/{id}
  tags: string[]          // ['users', 'admin']
  summary: string         // Short description
import { operations } from '~/api.gen/docs-operations.gen';

<DataTable<OperationSummaryan    // Deprecation flag
  hasAuth?: boolean       // Has security requirements
  hasParams?: boolean     // Has parameters
  hasRequestBody?: boolean // Has request body
}

interface TagSummary {
  name: string
  description?: string
  count: number          // Number of operations
}
```

### Secondary Data (Full Spec)
Import full spec for expanded details (on-demand):

```typescript
// In operation-row-details.tsx
import spec from '~/api.gen/openapi.json';

Lazy load from full OpenAPI spec:

```typescript
// operation-row-details.tsx
import spec from '~/api.gen/openapi.json';

const fullOperation = spec.paths[operation.path]?.[operation.method];
```

Show:
// Look up full operation details by path + method
const fullOperation = spec.paths[operation.path][operation.method];
```

**Secondary data includes:**
- Full description (Markdown)
- Parameters (path, query, header, cookie)
- Request body schema
- Response schemas
- Security schemes
- Examplesarameters: Parameter[]
  requestBody?: RequestBody
  responses: Record<string, Response>
  security?: SecurityRequirement[]
}
```

## UI Components

### Layout
- **Sidebar** (fixed left): Tag navigation, click to filter table
- **Toolbar** (top): Search input + tag filter dropdown
- **Content** (scrollable): DataTable with expandable rows

### Table Implementation
Follow `~/modules/pages/table/` pattern:

```typescript
// operation-table.tsx
<DataTable<Operation>
  columns={operationColumns}
  rows={filteredOperations}
  rowKeyGetter={(row) => row.id}
  hasNextPage={false}
  enableVirtualization={operations.length > 100}
  sortColumns={sortColumns}
  onSortColumnsChange={setSortColumns}
/>
```

### Columns
Define in `operation-columns.tsx` following `use-columns.tsx` pattern:

1. **Method** - Badge (color-coded by HTTP method)
2. **Path** - Endpoint path
3. **Summary** - Truncated with `table-ellipsis`
4. **Tags** - Tag badges
5. **Auth** - Security icon
6. **Expand** - Using `toggle-expand` component

### Expanded Row Content
- Description (Markdown)
- Parameters table
- Request body schema
- Response schemas
- Security requirements

## Features

### V1 Included âœ…
- Table view
- Tag filtering (sidebar + dropdown)
- Search operations
- **Plugin generates lightweight array** at build time (not runtime)
- **Smaller initial bundle** - Only operation summaries in main bundle
- **Lazy load details** - Full spec imported only when expanding rows
- Virtual scrolling for 100+ operations (built into DataTable)
- Code split schema viewer

## Plugin Implementation
Create docs plugin in `vite/docs-plugin/`
2. Add plugin to `openapi-ts.config.ts`
3. Add source output to `openapi-ts.config.ts`
4. Add route to `marketing-routes.tsx`
5
```typescript
// index.ts
import type { Plugin } from '@hey-api/openapi-ts';

export const docsPlugin = (config?: { fileName?: string }): Plugin => ({
  name: 'docs-plugin',
  handler: ({ plugin, context }) => {
    const operations: OperationSummary[] = [];
    const tags: TagSummary[] = [];
    
    // Transform spec to lightweight arrays
    plugin.forEach('operation', (op) => {
      operations.push({
        id: op.id,
        method: op.method,
        path: op.path,
        tags: op.tags || [],
        summary: op.summary,
        deprecated: op.deprecated,
        hasAuth: !!op.security?.length,
        hasParams: !!op.parameters?.length,
        hasRequestBody: !!op.requestBody,
      });
    });
    
    // Generate TypeScript file
    context.writeFile({
      fileName: config?.fileName || 'docs-operations',
      content: generateOperationsFile(operations, tags),
    });
  },
});
```

### V1 Excluded âŒ
- List/card view (V2)
- Try-it functionality
- Code examples

## Performance

- Parse OpenAPI once, memoize flat array
- Virtual scrolling for 100+ operations (built into DataTable)
- Lazy load expanded row content
- Code split schema viewer

## Configuration

1. Add source output to `openapi-ts.config.ts`
2. Add route to `marketing-routes.tsx`
3. Add to route tree

## Success Criteria

1. Loads in < 500ms
2. Handles 100+ operations smoothly
3. Expandable rows with full details
4. Mobile responsive
5. Hash routing works
