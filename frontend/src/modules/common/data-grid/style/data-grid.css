/**
 * Cella Data Grid Styles
 * Migrated from ecij CSS-in-JS to plain CSS with Tailwind CSS variables
 */

/* CSS Layers for proper cascade ordering */
@layer rdg.Defaults, rdg.Root, rdg.Row, rdg.Cell, rdg.FocusSink;

/* ==========================================================================
   Root / Grid Container
   ========================================================================== */

@layer rdg.Defaults {
  .rdg *,
  .rdg *::before,
  .rdg *::after {
    box-sizing: inherit;
  }
}

@layer rdg.Root {
  .rdg {
    /* CSS Custom Properties - can be overridden */
    --rdg-selection-width: 2px;
    --rdg-selection-color: hsl(var(--primary));
    --rdg-font-size: 0.875rem;
    --rdg-cell-frozen-box-shadow: 2px 0 5px -2px rgba(136, 136, 136, 0.3);
    --rdg-border-width: 1px;
    --rdg-color: hsl(var(--foreground));
    --rdg-border-color: hsl(var(--border));
    --rdg-background-color: hsl(var(--background));
    --rdg-header-background-color: hsl(var(--muted));
    --rdg-row-hover-background-color: hsl(var(--muted) / 0.5);
    --rdg-row-selected-background-color: hsl(var(--accent));
    --rdg-row-selected-hover-background-color: hsl(var(--accent));
    /* Z-index for frozen rows portal - can be overridden per grid instance */
    --rdg-frozen-row-z-index: 100;

    display: grid;
    accent-color: hsl(var(--primary));

    /* Page-embedded mode: vertical overflow visible, horizontal scroll internal */
    contain: layout style;
    content-visibility: auto;
    border: 1px solid var(--rdg-border-color);
    box-sizing: border-box;
    overflow-x: auto;
    overflow-y: visible;
    background-color: var(--rdg-background-color);
    color: var(--rdg-color);
    font-size: var(--rdg-font-size);
  }

  .rdg.rdg-dark {
    color-scheme: dark;
  }

  .rdg.rdg-light {
    color-scheme: light;
  }

  /* Firefox scrollbar fix */
  .rdg::before {
    content: "";
    grid-column: 1 / -1;
    grid-row: 1 / -1;
  }
}

/* ==========================================================================
   Row Styles
   ========================================================================== */

@layer rdg.Row {
  .rdg-row {
    display: contents;
    background-color: var(--rdg-background-color);
  }

  .rdg-row:hover {
    background-color: var(--rdg-row-hover-background-color);
  }

  .rdg-row[aria-selected="true"] {
    background-color: var(--rdg-row-selected-background-color);
  }

  .rdg-row[aria-selected="true"]:hover {
    background-color: var(--rdg-row-selected-hover-background-color);
  }
}

/* ==========================================================================
   Cell Styles
   ========================================================================== */

@layer rdg.Cell {
  .rdg-cell {
    position: relative;
    padding-block: 0;
    padding-inline: 0.5rem;
    border-inline-end: var(--rdg-border-width) solid var(--rdg-border-color);
    border-block-end: var(--rdg-border-width) solid var(--rdg-border-color);
    grid-row-start: var(--rdg-grid-row-start);
    align-content: center;
    background-color: inherit;

    white-space: nowrap;
    overflow: clip;
    text-overflow: ellipsis;
    outline: none;
  }

  .rdg-cell[aria-selected="true"] {
    outline: var(--rdg-selection-width) solid var(--rdg-selection-color);
    outline-offset: calc(var(--rdg-selection-width) * -1);
  }

  /* Frozen cells */
  .rdg-cell-frozen {
    position: sticky;
    z-index: 1;
  }

  .rdg-cell-frozen:nth-last-child(1 of .rdg-cell-frozen) {
    box-shadow: var(--rdg-cell-frozen-box-shadow);
  }
}

/* ==========================================================================
   Focus Sink (for keyboard navigation outline)
   ========================================================================== */

@layer rdg.FocusSink {
  .rdg-focus-sink {
    grid-column: 1 / -1;
    pointer-events: none;
    /* Make the focus sink render above frozen cells */
    z-index: 2;
  }

  .rdg-focus-sink-header-summary {
    /* row outline should not cover the focus outline */
    z-index: 3;
  }

  .rdg-row-selected-outline {
    outline: 2px solid var(--rdg-selection-color);
    outline-offset: -2px;
  }

  .rdg-row-selected-frozen::before {
    content: "";
    display: inline-block;
    block-size: 100%;
    position: sticky;
    inset-inline-start: 0;
    border-inline-start: 2px solid var(--rdg-selection-color);
  }
}

/* ==========================================================================
   Header Row
   ========================================================================== */

.rdg-header-row {
  display: contents;
  font-weight: 600;
  background-color: var(--rdg-header-background-color);
}

.rdg-header-row > .rdg-cell {
  background-color: var(--rdg-header-background-color);
}

/* ==========================================================================
   Additional classes
   ========================================================================== */

/* Group Row */
.rdg-group-row:not([aria-selected="true"]) {
  background-color: var(--rdg-header-background-color);
}

.rdg-group-row > .rdg-cell:not(:last-child, .rdg-cell-frozen),
.rdg-group-row > :nth-last-child(n + 2 of .rdg-cell-frozen) {
  border-inline-end: none;
}

/* ==========================================================================
   Cell Range Selection
   ========================================================================== */

.rdg-cell-range-top {
  border-block-start: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

.rdg-cell-range-bottom {
  border-block-end: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

.rdg-cell-range-left {
  border-inline-start: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

.rdg-cell-range-right {
  border-inline-end: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

/* ==========================================================================
   Touch Mode
   ========================================================================== */

.rdg-touch-mode {
  --rdg-touch-cell-padding: 0.75rem;
}

.rdg-touch-mode .rdg-cell {
  padding-inline: var(--rdg-touch-cell-padding);
  min-block-size: 44px;
}

/* ==========================================================================
   Mobile Sub-Row
   ========================================================================== */

.rdg-mobile-sub-rows .rdg-row-expandable {
  position: relative;
}

.rdg-mobile-expand-toggle {
  position: absolute;
  inset-inline-start: 0.25rem;
  inset-block-start: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  inline-size: 1.5rem;
  block-size: 1.5rem;
  padding: 0;
  border: none;
  border-radius: 0.25rem;
  background-color: transparent;
  color: hsl(var(--muted-foreground));
  cursor: pointer;
  transition:
    background-color 0.15s,
    color 0.15s;
  z-index: 1;
}

.rdg-mobile-expand-toggle:hover {
  background-color: hsl(var(--muted));
  color: hsl(var(--foreground));
}

.rdg-mobile-expand-toggle:focus-visible {
  outline: 2px solid var(--rdg-selection-color);
  outline-offset: 2px;
}

.rdg-mobile-expand-toggle svg {
  transition: transform 0.15s ease;
}

.rdg-row-expanded .rdg-mobile-expand-toggle svg {
  transform: rotate(90deg);
}

.rdg-mobile-sub-row {
  display: none;
  grid-column: 1 / -1;
  padding: 0.5rem 1rem;
  background-color: hsl(var(--muted) / 0.3);
  border-block-end: var(--rdg-border-width) solid var(--rdg-border-color);
}

.rdg-row-expanded + .rdg-mobile-sub-row {
  display: block;
}
