/**
 * Cella Data Grid Styles
 * Migrated from ecij CSS-in-JS to plain CSS with Tailwind CSS variables
 */

/* CSS Layers for proper cascade ordering */
@layer rdg.Defaults, rdg.Root, rdg.Row, rdg.Cell, rdg.FocusSink, rdg.DragHandle, rdg.Checkbox;

/* ==========================================================================
   Root / Grid Container
   ========================================================================== */

@layer rdg.Defaults {
  .rdg *,
  .rdg *::before,
  .rdg *::after {
    box-sizing: inherit;
  }
}

@layer rdg.Root {
  .rdg {
    /* CSS Custom Properties - can be overridden */
    --rdg-selection-width: 2px;
    --rdg-selection-color: hsl(var(--primary));
    --rdg-font-size: 0.875rem;
    --rdg-cell-frozen-box-shadow: 2px 0 5px -2px rgba(136, 136, 136, 0.3);
    --rdg-border-width: 1px;
    --rdg-summary-border-width: calc(var(--rdg-border-width) * 2);
    --rdg-color: hsl(var(--foreground));
    --rdg-border-color: hsl(var(--border));
    --rdg-summary-border-color: hsl(var(--border));
    --rdg-background-color: hsl(var(--background));
    --rdg-header-background-color: hsl(var(--muted));
    --rdg-header-draggable-background-color: hsl(var(--muted));
    --rdg-row-hover-background-color: hsl(var(--muted) / 0.5);
    --rdg-row-selected-background-color: hsl(var(--accent));
    --rdg-row-selected-hover-background-color: hsl(var(--accent));
    --rdg-checkbox-focus-color: hsl(var(--ring));

    display: grid;
    accent-color: hsl(var(--primary));

    /* Stacking context and containment */
    contain: content;
    content-visibility: auto;
    block-size: 350px;
    border: 1px solid var(--rdg-border-color);
    box-sizing: border-box;
    overflow: auto;
    background-color: var(--rdg-background-color);
    color: var(--rdg-color);
    font-size: var(--rdg-font-size);
  }

  .rdg.rdg-dark {
    color-scheme: dark;
  }

  .rdg.rdg-light {
    color-scheme: light;
  }

  .rdg:dir(rtl) {
    --rdg-cell-frozen-box-shadow: -2px 0 5px -2px rgba(136, 136, 136, 0.3);
  }

  /* Firefox scrollbar fix */
  .rdg::before {
    content: "";
    grid-column: 1 / -1;
    grid-row: 1 / -1;
  }

  /* Summary row borders */
  .rdg > :nth-last-child(1 of .rdg-top-summary-row) > .rdg-cell {
    border-block-end: var(--rdg-summary-border-width) solid var(--rdg-summary-border-color);
  }

  .rdg > :nth-child(1 of .rdg-bottom-summary-row) > .rdg-cell {
    border-block-start: var(--rdg-summary-border-width) solid var(--rdg-summary-border-color);
  }
}

.rdg-viewport-dragging {
  user-select: none;
}

.rdg-viewport-dragging .rdg-row {
  cursor: move;
}

/* ==========================================================================
   Row Styles
   ========================================================================== */

@layer rdg.Row {
  .rdg-row {
    display: contents;
    background-color: var(--rdg-background-color);
  }

  .rdg-row:hover {
    background-color: var(--rdg-row-hover-background-color);
  }

  .rdg-row[aria-selected="true"] {
    background-color: var(--rdg-row-selected-background-color);
  }

  .rdg-row[aria-selected="true"]:hover {
    background-color: var(--rdg-row-selected-hover-background-color);
  }
}

/* ==========================================================================
   Cell Styles
   ========================================================================== */

@layer rdg.Cell {
  .rdg-cell {
    position: relative;
    padding-block: 0;
    padding-inline: 0.5rem;
    border-inline-end: var(--rdg-border-width) solid var(--rdg-border-color);
    border-block-end: var(--rdg-border-width) solid var(--rdg-border-color);
    grid-row-start: var(--rdg-grid-row-start);
    align-content: center;
    background-color: inherit;

    white-space: nowrap;
    overflow: clip;
    text-overflow: ellipsis;
    outline: none;
  }

  .rdg-cell[aria-selected="true"] {
    outline: var(--rdg-selection-width) solid var(--rdg-selection-color);
    outline-offset: calc(var(--rdg-selection-width) * -1);
  }

  /* Frozen cells */
  .rdg-cell-frozen {
    position: sticky;
    z-index: 1;
  }

  .rdg-cell-frozen:nth-last-child(1 of .rdg-cell-frozen) {
    box-shadow: var(--rdg-cell-frozen-box-shadow);
  }
}

/* ==========================================================================
   Focus Sink (for keyboard navigation outline)
   ========================================================================== */

@layer rdg.FocusSink {
  .rdg-focus-sink {
    grid-column: 1 / -1;
    pointer-events: none;
    /* Make the focus sink render above frozen cells */
    z-index: 2;
  }

  .rdg-focus-sink-header-summary {
    /* row outline should not cover the focus outline */
    z-index: 3;
  }

  .rdg-row-selected-outline {
    outline: 2px solid var(--rdg-selection-color);
    outline-offset: -2px;
  }

  .rdg-row-selected-frozen::before {
    content: "";
    display: inline-block;
    block-size: 100%;
    position: sticky;
    inset-inline-start: 0;
    border-inline-start: 2px solid var(--rdg-selection-color);
  }
}

/* ==========================================================================
   Drag Handle
   ========================================================================== */

@layer rdg.DragHandle {
  .rdg-cell-drag-handle {
    --rdg-drag-handle-size: 8px;
    z-index: 0;
    cursor: move;
    inline-size: var(--rdg-drag-handle-size);
    block-size: var(--rdg-drag-handle-size);
    background-color: var(--rdg-selection-color);
    place-self: end;
  }

  .rdg-cell-drag-handle:hover {
    --rdg-drag-handle-size: 16px;
    border: 2px solid var(--rdg-selection-color);
    background-color: var(--rdg-background-color);
  }

  .rdg-cell-drag-handle-frozen {
    z-index: 1;
    position: sticky;
  }
}

/* ==========================================================================
   Header Row
   ========================================================================== */

.rdg-header-row {
  display: contents;
  font-weight: 600;
  background-color: var(--rdg-header-background-color);
}

.rdg-header-row > .rdg-cell {
  background-color: var(--rdg-header-background-color);
}

.rdg-header-row-draggable > .rdg-cell {
  background-color: var(--rdg-header-draggable-background-color);
}

/* ==========================================================================
   Checkbox
   ========================================================================== */

@layer rdg.Checkbox {
  .rdg-checkbox-label {
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    inset: 0;
  }

  .rdg-checkbox-label-disabled {
    cursor: default;
  }

  .rdg-checkbox-input {
    /* Visually hidden but accessible */
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  .rdg-checkbox {
    content: "";
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid var(--rdg-border-color);
    border-radius: 0.25rem;
    background-color: var(--rdg-background-color);
  }

  .rdg-checkbox-input:checked + .rdg-checkbox {
    background-color: hsl(var(--primary));
    border-color: hsl(var(--primary));
    background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
  }

  .rdg-checkbox-input:indeterminate + .rdg-checkbox {
    background-color: hsl(var(--primary));
    border-color: hsl(var(--primary));
    background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M4 8a1 1 0 011-1h6a1 1 0 110 2H5a1 1 0 01-1-1z'/%3e%3c/svg%3e");
  }

  .rdg-checkbox-input:focus-visible + .rdg-checkbox {
    outline: 2px solid var(--rdg-checkbox-focus-color);
    outline-offset: 2px;
  }
}

/* ==========================================================================
   Sort Icon
   ========================================================================== */

.rdg-sort-icon {
  display: inline-flex;
  margin-inline-start: 0.25rem;
}

/* ==========================================================================
   Text Editor
   ========================================================================== */

.rdg-text-editor {
  appearance: none;
  box-sizing: border-box;
  inline-size: 100%;
  block-size: 100%;
  padding-block: 0;
  padding-inline: 0.375rem;
  border: 2px solid hsl(var(--primary));
  vertical-align: top;
  color: var(--rdg-color);
  background-color: var(--rdg-background-color);
  font-family: inherit;
  font-size: var(--rdg-font-size);
}

.rdg-text-editor::placeholder {
  color: hsl(var(--muted-foreground));
  opacity: 1;
}

.rdg-text-editor:focus {
  outline: none;
  border-color: hsl(var(--ring));
}

/* ==========================================================================
   Grouped Header
   ========================================================================== */

.rdg-grouped-column-header-row {
  display: contents;
}

.rdg-grouped-column-header-cell {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--rdg-header-background-color);
  border-inline-end: var(--rdg-border-width) solid var(--rdg-border-color);
  border-block-end: var(--rdg-border-width) solid var(--rdg-border-color);
}

/* ==========================================================================
   Additional classes migrated from ecij CSS-in-JS
   ========================================================================== */

/* Header Cell */
.rdg-cell-sortable {
  cursor: pointer;
}

.rdg-cell-resizable {
  touch-action: none;
}

.rdg-resize-handle {
  cursor: col-resize;
  position: absolute;
  inset-block-start: 0;
  inset-inline-end: 0;
  inset-block-end: 0;
  inline-size: 10px;
}

.rdg-cell-dragging {
  background-color: var(--rdg-header-draggable-background-color);
}

.rdg-cell-drag-over {
  background-color: var(--rdg-header-draggable-background-color);
}

.rdg-drag-image {
  border-radius: 4px;
  width: fit-content;
  outline: 2px solid hsl(207, 100%, 50%);
  outline-offset: -2px;
}

/* Cell Dragged Over */
.rdg-cell-dragged-over {
  background-color: hsl(var(--accent) / 0.3);
}

/* Edit Cell */
.rdg-cell-editing {
  padding: 0;
}

/* Summary Row */
.rdg-summary-row > .rdg-cell {
  position: sticky;
}

.rdg-top-summary-row-sticky > .rdg-cell {
  z-index: 2;
}

.rdg-top-summary-row-sticky > .rdg-cell-frozen {
  z-index: 3;
}

.rdg-summary-cell {
  inset-block-start: var(--rdg-summary-row-top);
  inset-block-end: var(--rdg-summary-row-bottom);
}

/* Group Row */
.rdg-group-row:not([aria-selected="true"]) {
  background-color: var(--rdg-header-background-color);
}

.rdg-group-row > .rdg-cell:not(:last-child, .rdg-cell-frozen),
.rdg-group-row > :nth-last-child(n + 2 of .rdg-cell-frozen) {
  border-inline-end: none;
}

/* Group Cell Content */
.rdg-group-cell-content {
  outline: none;
}

/* Caret */
.rdg-caret {
  margin-inline-start: 4px;
  stroke: currentColor;
  stroke-width: 1.5px;
  fill: transparent;
  vertical-align: middle;
}

.rdg-caret > path {
  transition: d 0.1s;
}

/* Sortable Header Cell */
.rdg-header-sort-cell {
  display: flex;
}

.rdg-header-sort-name {
  flex-grow: 1;
  overflow: clip;
  text-overflow: ellipsis;
}

/* Measuring Cell */
.rdg-measuring-cell {
  contain: strict;
  grid-row: 1;
  visibility: hidden;
}

/* Sort Arrow */
.rdg-sort-arrow {
  fill: currentColor;
}

.rdg-sort-arrow > path {
  transition: d 0.1s;
}

/* Checkbox */
.rdg-checkbox-input {
  display: block;
  margin: auto;
  inline-size: 20px;
  block-size: 20px;
}

.rdg-checkbox-input:focus-visible {
  outline: 2px solid var(--rdg-checkbox-focus-color);
  outline-offset: -3px;
}

.rdg-checkbox-input:enabled {
  cursor: pointer;
}

/* ==========================================================================
   Cell Range Selection
   ========================================================================== */

.rdg-cell-range-selected {
  background-color: hsl(var(--primary) / 0.1);
}

.rdg-cell-range-top {
  border-block-start: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

.rdg-cell-range-bottom {
  border-block-end: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

.rdg-cell-range-left {
  border-inline-start: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

.rdg-cell-range-right {
  border-inline-end: var(--rdg-selection-width) solid var(--rdg-selection-color);
}

/* ==========================================================================
   Touch Mode
   ========================================================================== */

.rdg-touch-mode {
  --rdg-touch-cell-padding: 0.75rem;
}

.rdg-touch-mode .rdg-cell {
  padding-inline: var(--rdg-touch-cell-padding);
  min-block-size: 44px;
}

.rdg-touch-mode .rdg-checkbox-label {
  min-block-size: 44px;
  min-inline-size: 44px;
}

/* ==========================================================================
   Mobile Sub-Row
   ========================================================================== */

.rdg-mobile-sub-rows .rdg-row-expandable {
  position: relative;
}

.rdg-mobile-expand-toggle {
  position: absolute;
  inset-inline-start: 0.25rem;
  inset-block-start: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  inline-size: 1.5rem;
  block-size: 1.5rem;
  padding: 0;
  border: none;
  border-radius: 0.25rem;
  background-color: transparent;
  color: hsl(var(--muted-foreground));
  cursor: pointer;
  transition:
    background-color 0.15s,
    color 0.15s;
  z-index: 1;
}

.rdg-mobile-expand-toggle:hover {
  background-color: hsl(var(--muted));
  color: hsl(var(--foreground));
}

.rdg-mobile-expand-toggle:focus-visible {
  outline: 2px solid var(--rdg-selection-color);
  outline-offset: 2px;
}

.rdg-mobile-expand-toggle svg {
  transition: transform 0.15s ease;
}

.rdg-row-expanded .rdg-mobile-expand-toggle svg {
  transform: rotate(90deg);
}

.rdg-mobile-sub-row {
  display: none;
  grid-column: 1 / -1;
  padding: 0.5rem 1rem;
  background-color: hsl(var(--muted) / 0.3);
  border-block-end: var(--rdg-border-width) solid var(--rdg-border-color);
}

.rdg-row-expanded + .rdg-mobile-sub-row {
  display: block;
}

.rdg-mobile-sub-item {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  padding-block: 0.25rem;
}

.rdg-mobile-sub-item:not(:last-child) {
  border-block-end: 1px solid hsl(var(--border) / 0.5);
}

.rdg-mobile-sub-key {
  flex-shrink: 0;
  font-weight: 500;
  color: hsl(var(--muted-foreground));
  min-inline-size: 6rem;
}

.rdg-mobile-sub-value {
  flex-grow: 1;
  color: hsl(var(--foreground));
  overflow: hidden;
  text-overflow: ellipsis;
}
